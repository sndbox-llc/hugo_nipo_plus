+++
title = "削除した項目の復旧"
# menuTitle = ""
draft = false
tags = ["日報テンプレート", "編集者権限"]
weight = 999
# description = "チャプター"
+++

本ページは誤って日報テンプレートから必要な項目を削除してしまった場合に対する復旧法について紹介してます。
その中で、テンプレートの「キー」について触れています。多くのケースでこの機能を意識する必要は有りません。
キーを誤って設定してしまうと予期せぬ動作を招く恐れがあるため**本ページで解説している内容は十分注意**して操作してください

## キーについて

日報やチェックシートのテンプレートは自由に入力フォームを配置できる点が特徴ですが、この配置された入力フォームには自動でキーが割り当てられています。
キーは3桁〜5桁のランダムな英数字の形をしてます。
1つのテンプレートには重複したキーは存在しないことになっています。そのためキーが分かればその入力フォームの位置が特定できる仕組みです。
また、反復入力フォームは少し特殊ですがキーの中に更にキーを持っています。

{{<alice pos="right" icon="ok">}}
例えば 「Ad2」や「Gzk」のような無作為な英数字です
{{</alice>}}

日報やチェックシートを作成する際はテンプレートのキーに合うように、入力のデータが格納されていきます。
入力データのキーと、テンプレートのキーがお互いにひも付きあうことで日報の表示ができる仕組みになっています。

## キーを手動で変更する必要がある場合

キーはこのようにシステムが自動で割り当てるため通常は手動で変更する必要は一切有りません。
しかし誤って削除してしまった入力フォームを再び復元させるときに限りキーを手動で調整する必要があります。
入力フォームを削除し、同じ入力フォームを追加しても追加されるキーは異なるキーになります。
誤って削除しても保存せずに終了すれば問題は有りませんが、厄介なのは誤って削除後に保存してしまったケースです。
この場合は過去の日報に影響が発生します。過去に作成された日報も削除した入力フォームのデータが表示されなくなります。
このようなケースに対する対策としてキーを手動で以前のキーに割り当て直すことができます。

### 削除前のキーを調査する

ここで誤って日報テンプレートから必要だった項目を削除してしまったと仮定します。本来、消してはならない本文入力を誤って削除してしまい、その事実に気づいたとします。

{{<imgproc deleted.png "誤ってテンプレートから必要な入力フォームを削除してしまった例。本来は2行目に本文が入力されているはずだった" />}}

日報表示画面からは本文が消えていますが、日報のデータ上は消えていません。生データから確認できます。生データは次の手順で確認できます

1. 日報表示画面をスクロールし、詳細情報をクリックする
1. 生データを表示をクリック
1. 生データが表示される

{{<imgproc rawdata.png "日報の生データを表示します。表示されていない本文データの内容が確認できました" />}}

生データを表示するとその日報を作成した時点でのデータがそのまま表示できます。ひとつ上の画像と見比べてほしいのですが、「これはサンプルです」という本文が日豊表示画面には表示されていませんが、生データ上には表示されていることがわかります。
また生データをみることで削除してしまった入力フォームの元のキーもわかります。この例では削除前のキーは xeHであることがわかりました。キーは大文字、小文字を判別しますので正しくこのキーを控えてください。

### テンプレートの編集からキーを上書きする

キーを控えたら日報テンプレートの編集画面を開き、削除前のキーに上書きしていきましょう

1. 誤って削除してしまった入力フォームを追加します
1. 削除前と異なるキーが割り当てられているので右下のスパナアイコンをクリックします
1. 控えていたキーに書き換えます
1. 保存をクリックします
1. テンプレートを保存します

まず誤って削除してしまった入力フォームを追加しますが、削除前と同じ種類入力フォームを追加してください。
追加する場所は基本的にどこでも大丈夫ですが、反復入力フォームの中で使用した項目を削除していた場合は必ずその反復入力フォームの中に追加するようにしてください。

追加された項目の右端にあるスパナアイコンをクリックするとキーの手動設定ウインドウが表示されます。初期値として今現在の入力フォームのキーが自動で表示されます。
今現在のキーを削除し、控えていたキーに変更し、保存してください。

{{<imgproc editKey.png "テンプレート編集画面から削除してしまったものと同じ入力フォームを追加し、キーを削除前のものに修正します" />}}

最後に保存をしてください。これで誤って削除してしまった入力フォームのデータが正常に表示されるはずです。実際に日豊表示画面を開き、確認してみましょう。

{{<imgproc recover.png "削除してしまった入力項目とそのデータが復旧" />}}

もし項目は追加されたのにデータが空欄の場合はキーが間違っている可能性があります。もう一度キーを確認してください。

## キーの取り扱いは十分注意してください

キーは本来ユーザが触れるべき項目では有りません。誤った操作により過去の日報が読めなくなる場合や予期せぬ問題が発生することも有りえます。
そのため今回のようなリカバリー目的以外でキーを変更することは行わないようにしてください。
またキーはユニーク（一意）である必要があります。他の入力フォームと同じキーを指定してしまった場合の挙動は未定義です。変更は十分注意して行うようにしてください。
