+++
description = "テンプレートカスタムパーツの1つ。報告内容によって行をまるごと増やしたいときに使用します。例えば時間ごとに作業内容を記したいとき、時間が何行になるか都度変わるためこのフォームを使用して解決できます。"
tags = ["テンプレートパーツ", "テンプレート"]
title = "【反復可変長入力】をレポートテンプレートに追加"
menuTitle = "🧩反復可変長入力"
toc = true
weight = 101001119
images = ["sample.png"]
aliases = ["/manual/initial-setting/template/array/"]
+++

そもそも反復とはどのようなものでしょうか？例えば次のようなレポートをイメージしてください。

{{<imgproc sample.png "反復入力フォームの具体例。時間ごとに作業内容を分けて書くといったケースでは必要な行数が毎回変わります。この場合は反復を使うとスマートに表現できます" />}}

上の図はWordで作成した簡易的なレポートの例です。赤枠で囲われた領域は作業内容に応じて使用する行数が変わることでしょう。
このようにレポート作成の都度行数が変化するものは**反復入力フォームで実装**できます。
反復入力フォーム自体は行の制御しか行いません。各列は反復入力の中に埋め込んで設計します。

{{<alice pos="right" icon="ok">}}
つまり反復フォーム単体＋各種入力フォームのあわせ技です
{{</alice>}}

## 反復入力の初期設定{#setting}

前述の通り、反復入力は単体では機能しないため反復入力を追加後に、反復入力の中に入力フォームを追加していきます。

{{<icatch filename="template" msg="反復入力の設定は反復の中に使用する項目（列）を追加して行きます">}}

以下は本入力フォームにのみ存在する設定項目です

<dl class="basic">
  <dt>入力切替を無効にする</dt>
  <dd>これがOnの場合、レポート作成時に入力方式（ラジオ・プルダウン）を変更するボタンが表示されなくなります。画面をスッキリさせたいときはONにしてください</dd>
  <dt><a href="/tips/required/">入力必須</a></dt>
  <dd>これがONの場合、選択肢が選ばれていないとレポートの提出ができません</dd>
  <dt>初期の行数</dt>
  <dd>レポート作成時に反復入力を生成する行数です。初期値は1です</dd>
</dl>

補足:[共通設定事項](/docs/manual/initial-setting/template/make/#common_setting)

## 反復入力フォームを使ったレポートの作成{#write}

反復入力フォームを含んだテンプレートを使って[レポートを書く](/docs/manual/write-report/write/)ときの画面は次のように見えます。

{{<icatch filename="input" msg="反復の含まれたレポートの入力画面イメージ。スマートフォンではカード風のレイアウトになります">}}

表示形式が**表・カードの2種類から切替が可能**です。スマートフォンではカード表示が初期状態になります。

画像では見えていませんが、1行追加ボタンをクリックすると新規の行が一番下に挿入されます。
行を削除したいときは各行の右端にあるゴミ箱アイコンをクリックします。

{{<alice pos="right" icon="book">}}
ゴミ箱が見えないときは横にスクロールしてください
{{</alice>}}

## 反復のレポートを表示{#show}

反復入力では偶数行と奇数行で色が互い違いに表示されます。

{{<icatch filename="post" msg="反復入力の偶数行は水色の背景で表示されます。視認性UP" alice="ok">}}

受信画面でも表示形式を**表・カードの2種類から切替が可能**です。

## 反復のレポートをCSVに出力する{#csv}

反復入力の中で使用されている入力フォームがCSV出力に対応していればCSV出力が可能です。
CSVは1行に1件のデータを表すデータ形式です。しかし反復入力は1件のレポートの中に複数行のデータが格納されることになるため、CSV出力の形式は反復入力の行数に合わせて提出者名などの**ヘッダー情報が2行目移行空欄で出力**されます。

{{<imgproc csv.png "レポートをCSVに出力した例" />}}

{{<alice pos="right" icon="here">}}2行目以降のヘッダー情報はCSV出力設定でコピー・空欄を選べます{{</alice>}}

## 反復のレポートをPDFに出力する{#pdf}

反復の列が多すぎるとPDFに出力する際レイアウトが崩れる可能性があるので注意してください。
基本的にはテンプレートの仕組みと同様に幅の合計が12に収まるように設計するとはみ出しにくくなります。
