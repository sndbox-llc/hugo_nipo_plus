+++
url = "/docs/manual/initial-setting/template/key/"
description = "テンプレート内の入力フォームを削除する方法と、誤って削除した際の復旧方法について"
# tags = ["テンプレート"]
title = "誤って削除したフォームの復旧とキーについて"
menuTitle = "【応用】キーについて"
toc = true
weight = 161
# aliases = []
# images = []
code = true
+++

{{< callout context="caution" title="注意" icon="outline/alert-triangle" >}}
本ページは応用編であり、プログラミングの世界に片足を突っ込むことになります。誤った操作をすると過去のレポートが読めなくなるなどのリスクがあります。
{{< /callout >}}

## 入力フォームを誤って削除してしまった場合の救出 {#about}

テンプレートをいつでも[自由にカスタマイズ](/docs/manual/initial-setting/template/make/)できるのは便利ですが、テンプレート内の[入力フォームを削除する際](/docs/manual/initial-setting/template/make/#removeForm)は注意が必要です。
テンプレート内のフォームを削除して保存すると、再度同じ項目を追加しても削除前に作られたレポート上にはその項目のデータが表示されません。
（※レポート作成時にこの項目は存在しませんでした。と表示されます）

同じタイトルで入力フォームを追加しても表示されない原因は、同じタイトルのフォームであっても異なるキーがランダムに割り当てられるためです。

問題の原因がキーにあるため、対応策は削除前と同じキーに設定することで問題を解決できます。

## 削除した入力フォームの復旧{#remove}

具体的な症状から、修正までの手順を順を追って解説します。
[JSONというデータ構造](https://knowledge.shade3d.jp/knowledgebase/json%E5%BD%A2%E5%BC%8F%E3%81%A8%E3%81%AF)については簡単で良いので理解してから作業してください。

### 削除してしまった画面を確認{#check}

仮に「天気・体調・業務報告」の３つで構成されたテンプレートで書かれたレポートがあるとします。
ここから誤って「業務報告」を削除してしまったと仮定します。

{{<iTablet filename="preRemoveForm" msg="今は表示されていますがテンプレート編集で誤って「業務報告」を消して保存したとします">}}

削除後、同じタイトルの入力フォームを作り直しても、入力されたデータは表示されません。

{{<iTablet filename="invalidKey" msg="同じタイトルのフォームを追加してもデータ復旧はしません">}}

### 削除前のデータから目的のキーを探す{#findKey}

「レポート作成時このフィールドは存在しなかった」と表示されるのは同タイトルで再生成しても異なるキーが割り当てられるためです。
キーは通常3〜5文字程度のランダムな英数字で構成されます。
削除前の入力フォームのキーを、過去のレポートから見つけることができます。
レポート表示画面から詳細表示を開き、生データを表示してください。

{{<iTablet filename="rawData" msg="レポートの生データを表示します" alice="guide">}}

生データはJSONと呼ばれるプログラミングの世界では広く使われている形式で保存されています。

```javascript
{
  "DQQ": "今日の業務内容を書きます",
  "Knn": "晴",
  "PTC": 3
}
```

生データを注意深く見ると、{ DQQ: 今日の業務内容を書きます }というデータがあります。レポート表示画面からは見えていませんでしたが、生データにはちゃんとデータが記録されていることが確認できました。
キーは DQQの部分です。このキー名を控えてください。

{{< callout context="caution" title="注意" icon="outline/alert-triangle" >}}
実際の生データはもっと数が多く複雑である可能性があります。印刷して１つ１つ照らし合わせて目的のデータを見つける必要があります
{{< /callout >}}

{{< callout context="caution" title="注意" icon="outline/alert-triangle" >}}
反復入力フォームなどが含まれている場合、JSONのデータが入れ子構造となるためより複雑になります。
{{< /callout >}}

### テンプレート編集画面からキー名を手動で変更する{#assertKey}

先ほど控えたキーをテンプレート編集画面から手動で適用させます。問題のある入力フォームのスパナアイコンをクリックしてキーを手動で書き換えできます。

{{<iTablet filename="rawData" msg="手動で入力フォームのキーを変更できます。作業は慎重に！" alice="here">}}

これで削除前のキーが反映されるようになります。過去のレポートを開き、正しく修正できていることを確認してください。

## キーを扱う際は細心の注意を払ってください{#hint}

キーはテンプレートを編集する際自動で割り当てられるランダムな文字列で、3桁から5桁で表現されます。通常の利用ではキーを手動で操作したり、そもそも存在を意識することすらありません。
今回のように誤ってフォームを削除してしまった場合にのみ利用します。
1つのテンプレート内に同じキーは存在しません。**同じキーが複数あると挙動がおかしくなる**ため、手動で設定する際は注意してください。
また、反復入力フォームは少し特殊ですがキーの中に更にキーを持っています。
