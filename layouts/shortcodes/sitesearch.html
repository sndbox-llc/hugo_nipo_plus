<!-- サイト内検索 -->
<div id="q-app">
  <div>
    <q-table grid title="Treats" :rows="books.data" :columns="columns" row-key="name" :filter="filter" hide-header  hide-bottom :rows-per-page-options="[0]" @row-click="rowClicked">
      <template #top>
        <q-input debounce="300" v-model="filter" placeholder="検索"></q-input>
      </template>
    </q-table>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js"></script>
<script src="https://cdn.jsdelivr.net/npm/quasar@2.7.1/dist/quasar.umd.prod.js"></script>
<script src="https://cdn.jsdelivr.net/npm/quasar@2.7.1/dist/lang/ja.umd.prod.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script>

<script>
  // 検索フォーム
  const app = Vue.createApp({
    // hugoとvueのデリミタが ｛｛｝｝でバッティングしてしまうため、本ページのvueは [[]]をデリミタとして定義する
    delimiters: ["[[", "]]"],
    setup () {
      const books = Vue.ref(undefined)
      const filter = Vue.ref('')
      const columns = [
        { name: 'date', align: 'date', label: '最終更新日', field: 'date', sortable: false },
        { name: 'title', label: 'タイトル', field: 'title', sortable: false },
        { name: 'summary', label: 'summary', field: 'summary' }
      ]
      // 表をクリック時、該当のURLへページ遷移
      function rowClicked (ev, row) {
        window.location.href =row.url
      }
      // 起動時初期化、検索用JSONファイルをロードする
      async function init () {
        const config = {
          method: 'GET',
          url: '/index.json'
        }
        console.log(config.url)
        try {
          books.value = await axios(config)
        } catch (e) {
          Quasar.Notify.create({ message: '検索初期化に失敗しました。検索は利用できません', color: 'negative' })
          console.error(e)
        }
      }
      init().catch(e => console.error(e))

      return {
        rowClicked,
        columns,
        filter,
        books
      }
    }
  })
  app.use(Quasar)
  Quasar.lang.set(Quasar.lang.ja)
  app.mount('#q-app')
</script>
