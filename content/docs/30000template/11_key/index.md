+++
url = "/docs/template/key/"
aliases = ["/docs/manual/initial-setting/template/key/"]
title = "【応用】キーについて - 削除した入力項目の復旧とデータ整合性"
menuTitle = "【応用】キーについて"
description = "NipoPlusのテンプレートで入力フォームを削除してしまい、過去の日報データが見えなくなった場合の復旧方法を解説します。日報データの「キー（識別子）」の概念と、それを手動で再設定することで、大切な過去の記録を正しく表示させるための手順を、専門知識がない方にも分かりやすく説明します。"
toc = true
weight = 30711
tags = ["データ活用編", "テンプレート管理", "日報の管理", "要編集者権限"]
+++

{{< callout context="caution" title="この設定には[編集者権限以上](/docs/setup/staff-global/rank/#manager)が必要です" icon="outline/info-triangle" />}}

{{< callout context="danger" title="重要：過去の日報データが正しく表示されなくなるリスクについて" icon="outline/alert-triangle" >}}
このページで解説する「キー」の操作は、NipoPlusのデータの根幹に関わる重要な設定です。**誤った操作を行うと、過去に作成された大切な日報データ（日報、点検記録など）の項目が表示されなくなるなどの問題が発生する可能性があります。**
作業は**細心の注意を払い、手順をよく理解してから**行ってください。
{{< /callout >}}

## 入力項目を誤って削除してしまった場合の復旧方法 {#about}

NipoPlusのテンプレートは[自由にカスタマイズ](/docs/template/make/)できるのが大きな特徴ですが、テンプレート内の入力フォームを削除する際は注意が必要です。

NipoPlusでは、テンプレートの各入力フォームに、**キー**と呼ばれる**見えない識別番号**（データの住所のようなもの）が自動的に割り当てられています。日報（日報や点検シートなど）を作成すると、その「キー」と「あなたの入力内容」がセットで保存されます。
もし、テンプレートから入力フォームを削除して保存してしまうと、過去にそのフォームを使って作成された日報では、その「**キー**」に紐づくデータを見つけることができなくなってしまいます。
たとえ、後から同じタイトルで入力フォームを作り直したとしても、新しく作られたフォームには別の新しい「キー（識別番号）」がランダムに割り当てられてしまうため、過去の日報のデータは表示されません。
**問題の根本原因は「キー」が変更されてしまったこと**にあります。したがって、過去の日報データを正しく表示させるためには、削除前と同じ「キー」を新しいフォームに手動で再設定することで問題を解決できます。

## 削除した入力フォームの復旧手順 {#remove}

ここでは、具体的な症状から、過去の日報データを復旧させるまでの手順を順を追って解説します。
専門知識は不要ですが、手順通りに慎重に進めてください。

### 1. 削除してしまった項目の表示状況を確認する{#check}

例えば「天気・体調・業務報告」の3つの項目で構成されたテンプレートで書かれた日報があるとします。
ここから誤って「業務報告」という項目を削除して保存してしまったと仮定します。

{{<iTablet filename="img/preRemoveForm" msg="テンプレートから「業務報告」の項目を誤って削除して保存してしまったとします。この操作が過去の日報に影響します" alice="here">}}

削除後、同じタイトル（例：「業務報告」）で新しい入力フォームを作り直してテンプレートを保存しても、過去の日報では「業務報告」の入力データは表示されません。

{{<iTablet filename="img/invalidKey" msg="同じ名前のフォームを追加しても、過去の日報のデータは復旧しません。これは「キー」が異なるためです" alice="here">}}

### 2. 過去の日報から目的の「キー」を探す{#findKey}

「日報作成時このフィールドは存在しなかった」と表示されるのは、同じタイトルでフォームを再生成しても、**異なる「キー（識別番号）」が割り当てられるため**です。この「キー」は通常、3〜5文字程度のランダムな英数字で構成されています。

削除前の入力フォームの「キー」は、過去の日報の「生データ」から見つけることができます。

1.  データを確認したい過去の日報を表示します。
2.  日報表示画面から「詳細表示」を開き、「生データを表示」ボタンをクリックしてください。

{{<iTablet filename="img/rawData" msg="過去の日報の「生データ」を表示します。ここには、日報に記録された全ての項目と、その「キー（識別番号）」が保存されています" alice="guide">}}

表示される「生データ」は、NipoPlusがデータを保存している形式です。少し複雑に見えるかもしれませんが、**目的の入力項目に対応するキー**を探します。

```javascript
{
  "DQQ": "今日の業務内容を書きます", // この「DQQ」がキーです
  "Knn": "晴",
  "PTC": 3
}
```

上記の例では、「DQQ: 今日の業務内容を書きます」のように、<strong>左側の3〜5文字程度の英数字（この場合は 「DQQ」 ）が「キー」です。</strong> 右側の引用符で囲まれた部分が、そのキーに対応するあなたの入力内容です。

日報表示画面からは見えていなかった「業務報告」のデータが、生データにはちゃんと記録されていることが確認できます。<strong>この「キー名」（例：「DQQ」）を正確に控えてください。</strong>

{{< callout context="caution" title="注意：複雑なデータ構造の場合" icon="outline/alert-triangle" >}}
実際の生データはもっと数が多い場合や、[反復入力フォーム](/docs/template/array/)などが含まれている場合、データが入れ子構造となるためより複雑に見える可能性があります。その場合でも、<strong>入力した内容を手がかりに、その近くにある3〜5文字の英数字がキー</strong>です。一つ一つ慎重に照らし合わせて目的のデータを見つける必要があります。
{{< /callout >}}

### 3. テンプレート編集画面から「キー」を手動で変更する{#assertKey}

先ほど控えた「キー」を、<strong>現在テンプレートに作り直したばかりの、表示が崩れている入力フォーム</strong>に手動で適用させます。

1.  テンプレート編集画面を開きます。
2.  修正したい入力フォーム（例：作り直した「業務報告」フォーム）の右下にあるスパナアイコンをクリックして設定画面を開きます。
3.  設定画面に表示される「キー」の欄に、控えておいた<strong>削除前の正確なキー（例：「DQQ」）を慎重に入力</strong>します。
4.  変更後、必ず「保存」ボタンをクリックしてテンプレートを保存してください。

{{<iTablet filename="img/rawData" msg="手動で入力フォームの「キー（識別番号）」を変更できます。作業は慎重に、控えておいたキーを正確に入力してください" alice="here">}}

これで、削除前と同じ「キー」が新しいフォームに反映されるようになります。過去の日報を開き、正しくデータが表示されるようになっていることを確認してください。

## 「キー」を扱う際の重要な注意点{#hint}

「キー」は通常、テンプレートを編集する際にNipoPlusが自動で割り当てるランダムな文字列で、3桁から5桁で表現されます。<strong>通常のテンプレート利用では、キーを手動で操作したり、その存在を意識することすらありません。</strong>

この「キー」を操作するのは、今回のように<strong>誤ってフォームを削除してしまい、過去の日報データを復旧させたい場合にのみ</strong>利用します。

<strong>【特に注意すべき点】</strong>

- <strong>1つのテンプレート内に同じキーは存在しません。</strong>もし同じキーが複数あると、システムの挙動がおかしくなる可能性があります。手動で設定する際は、必ず<strong>他のフォームのキーと重複しない</strong>ように注意してください。
- 反復入力フォームは少し特殊で、キーの中にさらにキーを持っています。反復入力内のフォームのキーを操作する際は、より一層慎重に確認してください。

この「キー」を正しく理解し、慎重に扱うことで、NipoPlusで記録された大切な過去の日報データを確実に管理し、活用し続けることができます。
